<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDG</title>

    <!-- Favicon -->
    <link rel="icon" href="data:image/png;base64,...==" type="image/x-icon">

    <!-- Styles -->
    <link rel="stylesheet" href="/static/styles.css?v=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

    <!-- Sidebar Toggle Button -->
    <a id="show-sidebar" class="btn btn-sm btn-dark" href="#"><i class="fas fa-bars"></i></a>

    <div class="page wrapper chiller-theme toggled">
        <!-- Sidebar -->
        {% include 'sidebar.html' %}

        <!-- Main Content -->
        <div class="container" style="padding: 20px;">
            <h2>Seismograph Data</h2>
            <div id="plot-bod-x" style="height: 300px;"></div>
            <div id="plot-bod-y" style="height: 300px;"></div>
            <div id="plot-bod-z" style="height: 300px;"></div>
        </div>
    </div>

    <!-- JS: Seismograph Graphs -->
    <script>
    document.addEventListener("DOMContentLoaded", async function () {
        try {
            const response = await fetch('/static/ivme.json');
            const data = await response.json();

            function plotWaveform(sensorName, elementId) {
                const sensor = data.sensor.find(s => s.name === sensorName);
                if (!sensor) return;

                const wf = sensor.waveform;
                const dt = wf.dt;
                const values = wf.wf_values;
                const timestamps = values.map((_, i) => i * dt);

                Plotly.newPlot(elementId, [{
                    x: timestamps,
                    y: values,
                    type: 'scatter',
                    mode: 'lines',
                    name: sensorName
                }], {
                    margin: { t: 30 },
                    title: sensorName + ' (' + sensor.unit + ')',
                    xaxis: { title: 'Time (s)' },
                    yaxis: { title: sensor.unit },
                    responsive: true
                }, { responsive: true });
            }

            plotWaveform("Bod_X", "plot-bod-x");
            plotWaveform("Bod_Y", "plot-bod-y");
            plotWaveform("Bod_Z", "plot-bod-z");

        } catch (err) {
            console.error('Veri y√ºklenemedi:', err);
        }
    });
    </script>

    <!-- JS: Sidebar Behavior -->
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const wrapper = document.querySelector(".page.wrapper");
        const showSidebarBtn = document.getElementById("show-sidebar");
        const closeSidebarBtn = document.getElementById("close-sidebar");

        function updateSidebarOnResize() {
            if (!wrapper) return;
            if (window.innerWidth <= 768) {
                wrapper.classList.add("toggled");
            } else {
                wrapper.classList.remove("toggled");
            }
            updateShowSidebarButton();
        }

        function updateShowSidebarButton() {
            if (!wrapper || !showSidebarBtn) return;
            showSidebarBtn.style.display = wrapper.classList.contains("toggled") ? "block" : "none";
        }

        updateSidebarOnResize();
        window.addEventListener("resize", updateSidebarOnResize);

        if (showSidebarBtn && wrapper) {
            showSidebarBtn.addEventListener("click", function (e) {
                e.preventDefault();
                wrapper.classList.remove("toggled");
                updateShowSidebarButton();
            });
        }

        if (closeSidebarBtn && wrapper) {
            closeSidebarBtn.addEventListener("click", function (e) {
                e.preventDefault();
                wrapper.classList.add("toggled");
                updateShowSidebarButton();
            });
        }

        document.querySelectorAll('.sidebar-dropdown > a').forEach(menu => {
            menu.addEventListener('click', function (e) {
                const parent = this.parentElement;
                const submenu = parent.querySelector('.sidebar-submenu');
                if (!submenu || this.getAttribute('href') !== '#') return;

                e.preventDefault();
                const isActive = parent.classList.contains('active');

                document.querySelectorAll('.sidebar-dropdown').forEach(item => {
                    item.classList.remove('active');
                    const sm = item.querySelector('.sidebar-submenu');
                    if (sm) sm.style.display = 'none';
                });

                if (!isActive) {
                    parent.classList.add('active');
                    submenu.style.display = 'block';
                }
            });
        });
    });
    </script>

</body>
</html>
