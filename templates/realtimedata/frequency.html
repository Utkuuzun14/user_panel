<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <title>TDG </title>
    <link rel="stylesheet" href="/static/styles.css?v=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" />
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAYCAYAAAAGXva8AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALDSURBVEhLrZa7axRBHMd3LxqNRCwkwQe+MODtXkTEQoNWNhaCaGfjqzO9hVhYmEJI4d9go0TFByIiKmKjCDa+chdROEkhany/UGM8P9+d2c3dZvd2inzhw/xmb2Z+O7/5zW/Pr4TBLs/zjsMGkKagAc/g5Gi1dkkPZ1MdvT0952k3Qskyx7IMlvL7hYmJ95PYsybt9CvtQtOdoddQZrffTNfzGK8X2wYHYDUsgJ8wxLi7tIXSAnONmSntUKFu1jzYC4dgO2yx7Qlwkpy20w9IO1XoFRk/6k1ruW0LJadKnDwpCunF1U8/k0qVcrnD2m0lpy+Mmak1sMqYifogMGaLur2Sv9LabaVE2kF7FHRlOuEXKDEWg5LkEdyAKiijd8JW+ADPQXPWQRfchHPwCnQsU42GV6/Wam+xE2WFKVIlLBNafxDzFKTDdhUGyVZltzJaO7wG69VP6TcMwTDjo6uXm0ij1TEN0OJKprTG4J0xNbY2TnPW9GZI2a4CtCLqIZfszZIWSs9VBcuTjmm+MYud6nzTV0bSOabn5h4ViqtcpLZObSU6AwpnHV7CbbjCb3qhZqk65UlH9c+YxTuVjsCeJvaBHKe12bZZ+gJJKW0XkhaRoUqEJaCzUUGJUX8tDEMvqJbHlUzrq9U1OhZHx8lpGJQ7fd9Xdg6Akih2qJCpr7Koa6UxI/AJ4nD+gToOtdtITk7Z5Saa66Cd5OkpDLB4XsYncnW6m+Y0LIoeZOs+DlWpEjFPGasX1sdAO9duH7okktQNRcW85RNZCQJt6CDoG3sRLsMduOfqVA6LoqICMC0/mqOPQ1IUrPpcneYViWZlrZX1oiVXp8rA5HLn6LNtm5X132rS1akK+l9j5uqJbWPpSj2AN/Dd8hFuOWVvGAZdDNTnaT8ogzUvTixFQd/cw2Tv4+iJFdmr+9sPOm/NYefe+H+IM6vdCn68xAAAAABJRU5ErkJggg==" type="image/x-icon">
</head>
    <body>
        <a id="show-sidebar" class="btn btn-sm btn-dark" href="#">
            <i class="fas fa-bars"></i>
        </a>
        <div class="page wrapper toggled">

            <!--Sidebar-->
            {% include 'sidebar.html' %}
      
            <main class="page-content">
                <div class="container-fluid">
                    <h2>Real-Time Data</h2>
                    <hr>
                    <div id="plot-container"></div>
                    
                </div>
                
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", async function () {
        try {
            const response = await fetch('/static/ivme.json');
            const data = await response.json();

            function plotWaveform(sensorNames, elementId) {
                // Birden fazla sensör için veri hazırla
                const traces = sensorNames.map(sensorName => {
                    const sensor = data.sensor.find(s => s.name === sensorName);
                    if (!sensor) {
                        console.warn(`${sensorName} sensörü bulunamadı!`);
                        return null;
                    }

                    const wf = sensor.waveform; 
                    const dt = wf.dt;
                    const values = wf.wf_values;
                    const timestamps = values.map((_, i) => i * dt);

                    return {
                        x: timestamps,
                        y: values,
                        type: 'scatter',
                        mode: 'lines',
                        name: sensorName + ' (' + sensor.unit + ')',
                        line: { width: 1.5 } // Çizgi kalınlığı
                    };
                }).filter(trace => trace !== null); // Null olanları filtrele

                // Eğer hiç veri yoksa uyarı ver
                if (traces.length === 0) {
                    console.error('Gösterilecek veri bulunamadı!');
                    return;
                }

                // Grafik ayarları
                const layout = {
                    margin: { t: 40, l: 50, r: 30, b: 40 },
                    title: 'Sensör Verileri',
                    xaxis: { 
                        title: 'Zaman (s)',
                        gridcolor: '#e0e0e0'
                    },
                    yaxis: { 
                        title: 'Genlik',
                        gridcolor: '#e0e0e0'
                    },
                    plot_bgcolor: '#f8f9fa',
                    paper_bgcolor: '#f8f9fa',
                    showlegend: true,
                    legend: {
                        orientation: 'h',
                        y: -0.2
                    },
                    hovermode: 'closest'
                };

                // Grafik oluştur
                Plotly.newPlot(elementId, traces, layout, {
                    responsive: true,
                    displayModeBar: true
                });
            }

            
            plotWaveform(["Bod_X", "Bod_Y", "Bod_Z"], "plot-container");

        } catch (err) {
            console.error('Veri yüklenirken hata oluştu:', err);
            // Hata durumunda kullanıcıya bilgi gösterebilirsin
            document.getElementById('plot-container').innerHTML = 
                '<div class="alert alert-danger">Veri yüklenirken hata oluştu: ' + err.message + '</div>';
        }
    });
</script>,

<!--Sidebar JS-->

<script>

document.addEventListener("DOMContentLoaded", function () {
  const wrapper = document.querySelector(".page.wrapper");
  const showSidebarBtn = document.getElementById("show-sidebar");
  const closeSidebarBtn = document.getElementById("close-sidebar");

  function updateSidebarOnResize() {
    if (!wrapper) return;
    if (window.innerWidth <= 768) {
      wrapper.classList.add("toggled");
    } else {
      wrapper.classList.remove("toggled");
    }
    updateShowSidebarButton();
  }

  function updateShowSidebarButton() {
    if (!wrapper || !showSidebarBtn) return;
    if (wrapper.classList.contains("toggled")) {
      showSidebarBtn.style.display = "block";
    } else {
      showSidebarBtn.style.display = "none";
    }
  }

  updateSidebarOnResize();
  window.addEventListener("resize", updateSidebarOnResize);

  if (showSidebarBtn && wrapper) {
    showSidebarBtn.addEventListener("click", function (e) {
      e.preventDefault();
      wrapper.classList.remove("toggled");
      updateShowSidebarButton();
    });
  }

  if (closeSidebarBtn && wrapper) {
    closeSidebarBtn.addEventListener("click", function (e) {
      e.preventDefault();
      wrapper.classList.add("toggled");
      updateShowSidebarButton();
    });
  }

  // Sidebar dropdown
  document.querySelectorAll('.sidebar-dropdown > a').forEach(menu => {
    menu.addEventListener('click', function (e) {
      const parent = this.parentElement;
      const submenu = parent.querySelector('.sidebar-submenu');
      if (!submenu || this.getAttribute('href') !== '#') return;

      e.preventDefault();
      const isActive = parent.classList.contains('active');

      document.querySelectorAll('.sidebar-dropdown').forEach(item => {
        item.classList.remove('active');
        const sm = item.querySelector('.sidebar-submenu');
        if (sm) sm.style.display = 'none';
      });

      if (!isActive) {
        parent.classList.add('active');
        submenu.style.display = 'block';
      }
    });
  });
});
</script>








    </body>
</html>
